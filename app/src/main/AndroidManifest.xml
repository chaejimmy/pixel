<?xml version="1.0" encoding="utf-8"?>

<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

    <!--
    Firebase automatically adds the AD_ID permission, even though we don't use it. If you use this
    permission you must declare how you're using it to Google Play, otherwise the app will be
    rejected when publishing it. To avoid this we remove the permission entirely.
    -->
    <uses-permission
        android:name="com.google.android.gms.permission.AD_ID"
        tools:node="remove" />

    <application
        android:name=".PaceDreamApplication"
        android:allowBackup="false"
        android:enableOnBackInvokedCallback="true"
        android:icon="@mipmap/pacedream_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/pacedream_launcher_round"
        android:supportsRtl="true"
        android:networkSecurityConfig="@xml/network_security_config"
        android:theme="@style/Theme.PaceDream.Splash"
        >
        <!-- Google Maps API key (map preview on listing detail). Set via resources for each build. -->
        <meta-data
            android:name="com.google.android.geo.API_KEY"
            android:value="@string/google_maps_key" />

        <profileable
            android:shell="false"
            tools:targetApi="q" />

        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTask">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>

            <!-- Deep links for Stripe checkout callbacks (App Links) -->
            <!-- booking-success on www.pacedream.com -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="https"
                    android:host="www.pacedream.com"
                    android:pathPrefix="/booking-success" />
            </intent-filter>
            
            <!-- booking-success on pacedream.com (without www) -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="https"
                    android:host="pacedream.com"
                    android:pathPrefix="/booking-success" />
            </intent-filter>
            
            <!-- booking-cancelled on www.pacedream.com -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="https"
                    android:host="www.pacedream.com"
                    android:pathPrefix="/booking-cancelled" />
            </intent-filter>
            
            <!-- booking-cancelled on pacedream.com (without www) -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="https"
                    android:host="pacedream.com"
                    android:pathPrefix="/booking-cancelled" />
            </intent-filter>

            <!-- Auth0 Universal Login callback (custom scheme) -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="pacedream"
                    android:host="callback" />
            </intent-filter>
            
            <!-- Legacy Auth0 callback scheme -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <data
                    android:scheme="com.pacedream.app"
                    android:host="auth0" />
            </intent-filter>

        </activity>

        <!-- Disable Firebase analytics by default. This setting is overwritten for the `prod`
        flavor -->
        <meta-data
            android:name="firebase_analytics_collection_deactivated"
            android:value="true" />
        <!-- Disable collection of AD_ID for all build variants -->
        <meta-data
            android:name="google_analytics_adid_collection_enabled"
            android:value="false" />

        <receiver
            android:name="com.shourov.apps.pacedream.core.data.receiver.OTPReceiver"
            android:exported="true"
            android:permission="com.google.android.gms.auth.api.phone.permission.SEND">
            <intent-filter>
                <action android:name="com.google.android.gms.auth.api.phone.SMS_RETRIEVED" />
            </intent-filter>
        </receiver>

        <!-- Firebase Messaging Service -->
        <service
            android:name=".notification.PaceDreamFirebaseMessagingService"
            android:exported="false">
            <intent-filter>
                <action android:name="com.google.firebase.MESSAGING_EVENT" />
            </intent-filter>
        </service>
    </application>

</manifest>
